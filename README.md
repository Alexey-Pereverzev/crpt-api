# crpt-api

Задание:
Необходимо реализовать на языке Java (можно использовать 17
версию) класс для работы с API Честного знака. Класс должен быть
thread-safe и поддерживать ограничение на количество запросов к
API. Ограничение указывается в конструкторе в виде количества
запросов в определенный интервал времени. Например:
public CrptApi(TimeUnit timeUnit, int requestLimit)
timeUnit – указывает промежуток времени – секунда, минута и пр.
requestLimit – положительное значение, которое определяет
максимальное количество запросов в этом промежутке времени.
При превышении лимита запрос вызов должен блокироваться,
чтобы не превысить максимальное количество запросов к API и
продолжить выполнение, без выбрасывания исключения, когда
ограничение на количество вызов API не будет превышено в
результате этого вызова. В любой ситуации превышать лимит на
количество запросов запрещено для метода.
Реализовать нужно единственный метод – Создание документа для
ввода в оборот товара, произведенного в РФ. Документ и подпись
должны передаваться в метод в виде Java объекта и строки
соответственно.

Решение:
Вызов POST-запроса осуществляется пулом потоков. Соблюдение плотности вызовов в единицу времени обеспечивается 2 механизмами:
1) семафор ограничивает сверху общее количество вызовов
2) после уменьшения счетчика светофора для каждого потока реализована задержка, которая регулирует частоту вызовов каждым потоком по принципу DELAY = TIME_UNIT / (REQUEST_LIMIT / POOL_SIZE).
   
Объяснение формулы. Чтобы получить количество раз, которое каждый поток должен выполниться за TIME_UNIT, мы берем (REQUEST_LIMIT / POOL_SIZE). Поэтому необходимая задержка для каждого потока, чтобы обеспечить нужную плотность выполнения будет результатом деления TIME_UNIT на это количество

Таким образом, если потоков досточно много, ограничение достигается лимитом семафора. Если же потоки полностью задействованы, нужная периодичность выполнения регулируется системой задержек (вызов метода delayAfterRequest())  
